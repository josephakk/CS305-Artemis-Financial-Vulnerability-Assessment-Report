package com.snhu.sslserver;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

@SpringBootApplication
public class SslServerApplication {

    public static void main(String[] args) {
        SpringApplication.run(SslServerApplication.class, args);
    }
}

@RestController
class ServerController {

    private static final Logger logger = LoggerFactory.getLogger(ServerController.class);

    @RequestMapping("/generateHash")
    public String generateHash() {
        
        String data = "Joseph Kawamoto, SNHU CS-305 Project 2";

        MessageDigest messageDigest;
        try {
            messageDigest = MessageDigest.getInstance("SHA-256");
        } catch (NoSuchAlgorithmException e) {
            logger.error("Error: Unable to create MessageDigest", e);
            return "Error: Unable to create MessageDigest";
        }

        messageDigest.update(data.getBytes(StandardCharsets.UTF_8));
        byte[] hash = messageDigest.digest();
        String hexHash = bytesToHex(hash);

        return "<p>Data: " + data + "<br>Algorithm: SHA-256" + "<br>Hash Value: " + hexHash + "</p>";
    }

    private String bytesToHex(byte[] bytes) {
        StringBuilder stringBuilder = new StringBuilder();
        for (byte b : bytes) {
            stringBuilder.append(String.format("%02x", b));
        }
        return stringBuilder.toString();
    }
}
